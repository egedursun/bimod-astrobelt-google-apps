<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Command Sidebar</title>
  <style>
    :root {
      --text-color: #ffffff;
      --hover-color: #aaaaaa;
      --active-color: #ffdd57;
      --disabled-color: #555555;
      --bg-color: #25293C;
      --border-color: #444444;
      --input-bg-color: #333333;
      --btn-magenta: #7367f0; /* Dark Magenta/Purple */
      --btn-danger: #e64449;
      --header-color: #DD4B39;
      --logo-size: 50px;
      --padding: 15px;
    }
    .btn:disabled {
      cursor: not-allowed;
      opacity: 0.3;
    }
    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: Arial, sans-serif;
      margin: 0;
      padding: var(--padding);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .logo {
      width: var(--logo-size);
      height: var(--logo-size);
      margin-bottom: var(--padding);
    }
    .menu-header {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--header-color);
      text-transform: uppercase;
      margin-bottom: var(--padding);
      text-align: center;
    }
    .menu-item {
      width: 100%;
      margin-bottom: var(--padding);
    }
    .menu-divider {
      width: 100%;
      height: 1px;
      background-color: var(--border-color);
      margin: var(--padding) 0;
    }
    .menu-link {
      color: var(--text-color);
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
      font-size: 0.95rem;
    }
    .input-field {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 5px;
      background-color: var(--input-bg-color);
      color: var(--text-color);
      box-sizing: border-box;
      font-size: 0.9rem;
    }
    .btn {
      display: inline-block;
      width: 100%;
      padding: 10px;
      background-color: var(--btn-magenta);
      color: var(--text-color);
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      text-align: center;
      font-size: 1rem;
      transition: background-color 0.3s;
    }
    .btn-clean {
      background-color: var(--btn-danger);
    }
    .btn:hover {
      background-color: var(--hover-color);
    }
    #result-output {
      padding: 10px;
      background-color: var(--input-bg-color);
      border-radius: 5px;
      color: var(--text-color);
      min-height: 40px;
      font-size: 0.9rem;
    }
    .border {
      border-radius: 5px;
      border: 2px solid #7367f0;;
    }
    .border-input {
      border-radius: 5px;
      border: 2px solid #7367f0;;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<!-- Logo -->
<div>
  <a href="https://www.bimod.io" class="" style="text-decoration: none; justify-content: center; align-items: center; display: flex;" target="_blank">
    <img src="https://bimod-static.s3.us-east-1.amazonaws.com/astrobelt-logo.png" alt="Logo" class="logo" style="width: 70%; height: auto;">
  </a>
</div>

<!-- Auto-Completion Action section -->
<div class="menu-item">
  <label for="command-type" class="menu-link"><small>Auto-Completion</small></label>
  <button id="btn-auto-complete" class="btn" style="margin-top: 6px;" onclick="requestAutocompletion()">
    <strong>
      <i class="fa fa-magic" style="margin-right: 8px;"></i>
      Auto-Complete
      </strong>
  </button>
</div>

<!-- Command Type Selector -->
<div class="menu-item">
  <label for="command-type" class="menu-link"><small>Command Type</small></label>
  <select id="command-type" class="input-field border-input">
    <option value="ai">General AI Command</option>
    <option value="web">Web Search Command</option>
    <option value="sql">SQL Database Command</option>
    <option value="nosql">NoSQL Database Command</option>
    <option value="ssh">SSH Server Command</option>
    <option value="vect">Document Search Command</option>
    <option value="repo">Code Search Command</option>
  </select>
</div>

<!-- Command Input Specification Input -->
<div class="menu-item">
  <label for="command-input" class="menu-link"><small>AI Prompt</small></label>
  <textarea id="command-input" class="input-field border-input" rows="1" placeholder="Type the command / request for your AI assistant here."></textarea>
</div>

<!-- Command Submit Button -->
<div class="menu-item">
  <button id="btn-ai-generate" class="btn" onclick="sendCommand()">
    <strong>
      <i class="fa fa-magic-wand-sparkles" style="margin-right: 8px;"></i>
      Generate
      </strong>
  </button>
</div>

<!-- Clear Input Button -->
<div class="menu-item">
  <button class="btn btn-clean" onclick="clearInput()">
    <strong>
      <i class="fa fa-refresh" style="margin-right: 8px;"></i>
      Clear Input
      </strong>
  </button>
</div>
<div class="menu-divider"></div>

<!-- Process Output Display Area -->
<div class="menu-item">
  <label class="menu-link">
    <small>
      <strong>
        <i class="fa fa-dashboard" style="margin-right: 8px;"></i>
        Processing Status
      </strong>
    </small>
  </label>
  <div id="result-output" class="border">
    <small>
      <strong>
        No result has been processed yet.
      </strong>
    </small>
  </div>
  <div style="margin-top: 4px;">
    <small>
      <strong>
        *You must wait 60 seconds between new commands.
      </strong>
    </small>
  </div>
</div>
<div class="menu-divider"></div>

<!-- Application Restart Button -->
<div class="menu-item">
  <button class="btn btn-clean" onclick="google.script.run.restartApplet()">
    <strong>
      <i class="fa fa-power-off" style="margin-right: 8px;"></i>
      Restart Applet
      </strong>
  </button>
</div>
<div class="menu-divider"></div>

<script>
  // Send Insertion Command Script
  function sendCommand() {
    const command = document.getElementById('command-input').value;
    const commandType = document.getElementById('command-type').value;
    const resultOutput = document.getElementById('result-output');
    const generateButton = document.getElementById('btn-ai-generate');
    if (commandType === 'select') {
      resultOutput.textContent = 'Processing...';
      generateButton.disabled = true;
      const timeout = setTimeout(() => {
        resultOutput.textContent = 'Request timed out. Please try again.';
        generateButton.disabled = false; // Re-enable button after timeout
      }, 60000);
      google.script.run
        .withSuccessHandler(function() {
          clearTimeout(timeout);
          resultOutput.textContent = 'Selected text replaced successfully.';
          generateButton.disabled = false;
        })
        .withFailureHandler(function(error) {
          clearTimeout(timeout);
          resultOutput.textContent = 'Error: ' + error.message;
          generateButton.disabled = false;
        })
        .sendSelectCommand(command);

    } else {
      // Send Select Command Script
      if (command) {
        resultOutput.textContent = 'Processing...';
        generateButton.disabled = true;
        const timeout = setTimeout(() => {
          resultOutput.textContent = 'Request timed out. Please try again.';
          generateButton.disabled = false;
        }, 60000);
        google.script.run
          .withSuccessHandler(function(response) {
            clearTimeout(timeout);
            resultOutput.textContent = response.output || 'No output returned';
            generateButton.disabled = false;
          })
          .withFailureHandler(function(error) {
            clearTimeout(timeout);
            resultOutput.textContent = 'Error: ' + error.message;
            generateButton.disabled = false;
          })
          .sendCommandToAI(command, commandType);
      } else {
        resultOutput.textContent = 'Please enter a command.';
      }
    }
  }
</script>
<script>
  // Clear Command Input Script
  function clearInput() {
    document.getElementById('command-input').value = '';
  }
</script>
<script>
  // Request Text Auto-Completion Script
  function requestAutocompletion() {
    const resultOutput = document.getElementById('result-output');
    const generateButton = document.getElementById('btn-auto-complete')
    resultOutput.textContent = 'Auto-completing...';
    generateButton.disabled = true;
    const timeout = setTimeout(() => {
      resultOutput.textContent = 'Request timed out. Please try again.';
      generateButton.disabled = false;
    }, 60000);
    google.script.run
      .withSuccessHandler(function(response) {
        clearTimeout(timeout);
        resultOutput.textContent = response.output || 'No output returned';
        generateButton.disabled = false;
      })
      .withFailureHandler(function(error) {
        clearTimeout(timeout);
        resultOutput.textContent = 'Error: ' + error.message;
        generateButton.disabled = false;
      })
      .sendAutoCompletionRequest();
  }
</script>
</body>
</html>